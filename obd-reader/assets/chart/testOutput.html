
<!doctype html>

<html>
<head>
<meta charset="utf-8" />
<title> Dash++ Visualization Metrics </title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<script src="https://www.google.com/jsapi"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="jquery.csv-0.71.js"></script>
<script>

    // load the visualization library from Google and set a listener
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(startConversion);

  function startConversion () 
  {
    if(isAPIAvailable()) 
    {
    	$(function () {
    		$("#button1").click(function (event) 
    		{
        		event.preventDefault();
        		$('#file').trigger('click');
    		});
    		document.getElementById('file').addEventListener('change', handleFileSelect, false);
		});
      // $('#files').bind('change', handleFileSelect);
    }
  }

  // $(document).ready(function() {
  //  if(isAPIAvailable()) {
  //    $('#files').bind('change', handleFileSelect);
  //  }
  // });

  function isAPIAvailable() {
    // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      // Great success! All the File APIs are supported.
      return true;
    } else {
      // source: File API availability - http://caniuse.com/#feat=fileapi
      // source: <output> availability - http://html5doctor.com/the-output-element/
      document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
      // 6.0 File API & 13.0 <output>
      document.writeln(' - Google Chrome: 13.0 or later<br />');
      // 3.6 File API & 6.0 <output>
      document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
      // 10.0 File API & 10.0 <output>
      document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
      // ? File API & 5.1 <output>
      document.writeln(' - Safari: Not supported<br />');
      // ? File API & 9.2 <output>
      document.writeln(' - Opera: Not supported');
      return false;
    }
  }

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var file = files[0];

    // read the file metadata
    var output = ''
        output += '<span style="font-weight:bold;">' + escape(file.name) + '</span><br />\n';
        output += ' - FileType: ' + (file.type || 'n/a') + '<br />\n';
        output += ' - FileSize: ' + file.size + ' bytes<br />\n';
        output += ' - LastModified: ' + (file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() : 'n/a') + '<br />\n';

    // read the file contents
    printTable(file);

    // post the results
    $('#list').append(output);
  }

  function printTable(file) {
    var reader = new FileReader();
    reader.readAsText(file);

    reader.onload = function(event)
    {
      var csv = event.target.result;
      var arrayData = $.csv.toArrays(csv, {onParseValue: $.csv.hooks.castToScalar});
      var data = $.csv.toArrays(csv);

      // this is the Data for the Table
      var html = '';
      for(var row in data) {
        html += '<tr>\r\n';
        for(var item in data[row]) {
          html += '<td>' + data[row][item] + '</td>\r\n';
        }
        html += '</tr>\r\n';
      }
      $('#contents').html(html);

      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);

      // s p e e d  /  e n t r y 

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([0,2]);

      // this sets basic options for our chart
      var options = {
          backgroundColor: 'transparent',
          title: "Vehicle Speed (per Entry)",
          hAxis: {title: data.getColumnLabel(0), minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {title: data.getColumnLabel(2), minValue: data.getColumnRange(2).min, maxValue: data.getColumnRange(2).max},
          legend: 'none'          
        };

      // this binds the chart to our <div> 
      var chartone = new google.visualization.LineChart(document.getElementById('chartone'));
      chartone.draw(view, options);

      // r p m  /  e n t r y

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([0,4]);

      // this sets basic options for our chart
      var options = {
          backgroundColor: 'transparent',
          title: "Engine Rotations per Minute (per Entry)",
          hAxis: {title: data.getColumnLabel(0), minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {title: data.getColumnLabel(4), minValue: data.getColumnRange(4).min, maxValue: data.getColumnRange(4).max},
          legend: 'none'
      };

      // this binds the chart to our <div> 
      var charttwo = new google.visualization.LineChart(document.getElementById('charttwo'));
      charttwo.draw(view, options);

     // f l o w  /  e n t r y 

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([0,5]);

      // this sets basic options for our chart
      var options = {
          backgroundColor: 'transparent',
          title: "Mass Air Flow (per Entry)",
          hAxis: {title: data.getColumnLabel(0), minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {title: data.getColumnLabel(5), minValue: data.getColumnRange(5).min, maxValue: data.getColumnRange(5).max},
          legend: 'none'
      };

      // this binds the chart to our <div> 
      var chartthree = new google.visualization.ScatterChart(document.getElementById('chartthree'));
      chartthree.draw(view, options);

      // t h r o t t l e  /  e n t r y

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([0,9]);

      // this sets basic options for our chart
      var options = {
          backgroundColor: 'transparent',
          title: "Throttle Position (per Entry)",
          hAxis: {title: data.getColumnLabel(0), minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {title: data.getColumnLabel(9), minValue: data.getColumnRange(9).min, maxValue: data.getColumnRange(9).max},
          legend: 'none'
      };

      // this binds the chart to our <div> 
      var chartfour = new google.visualization.LineChart(document.getElementById('chartfour'));
      chartfour.draw(view, options);

      // s p e e d  /  r p m

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([2,4]);

      // this sets basic options for our chart
      var options = {
          backgroundColor: 'transparent',
          title: "Speed vs. Engine RPM (per Entry)",
          hAxis: {title: data.getColumnLabel(2), minValue: data.getColumnRange(2).min, maxValue: data.getColumnRange(2).max},
          vAxis: {title: data.getColumnLabel(4), minValue: data.getColumnRange(4).min, maxValue: data.getColumnRange(4).max},
          legend: 'none'
      };

      // this binds the chart to our <div> 
      var chartfive = new google.visualization.ScatterChart(document.getElementById('chartfive'));
      chartfive.draw(view, options);
    };
    reader.onerror = function(){ alert('Unable to read ' + file.fileName); };
  }
</script>
</head>

<body background="tredlight.jpg">
<div id=inputs class=clearfix>
  <input id="button1" type="submit" value="add" />
  <input type="file" id="file" style="display: none">
  <h1 align="center">Dash++ Data Visualizations</h1>
   <div id="chartone"></div>
   <div id="charttwo"></div>
   <div id="chartthree"></div>
   <div id="chartfour"></div>
   <div id="chartfive"></div>
</div>
<hr />
<output id=list>
</output>
<hr />
<table id=contents style="width:100%; height:400px;" border>
</table>
</body>